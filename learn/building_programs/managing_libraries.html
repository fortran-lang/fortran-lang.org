<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Fortran Programming Language">
    <title>Managing libraries (static and dynamic libraries) - Fortran Programming Language</title>
    <link href="https://fonts.googleapis.com/css?family=Lato:400,700,900" rel="stylesheet">
    <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.0/themes/smoothness/jquery-ui.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/3.0.0/normalize.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.rawgit.com/konpa/devicon/df6431e323547add1b4cf45992913f15286456d3/devicon.min.css">
    <script src="https://unpkg.com/feather-icons"></script>
    <link href="/assets/css/main.css" rel="stylesheet">
    <link href="/assets/css/syntax.css" rel="stylesheet">
    <link rel="canonical" href="https://fortran-lang.org/learn/building_programs/managing_libraries" />
    <script src="https://kit.fontawesome.com/8d17d4fe97.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/octicons/2.0.2/octicons.min.css">
    <link rel="stylesheet" href="/assets/github-activity-0.1.5/github-activity-0.1.5.min.css">
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mustache.js/0.7.2/mustache.min.js"></script>
    <script type="text/javascript" src="/assets/github-activity-0.1.5/github-activity-0.1.5.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.bundle.min.js" integrity="sha256-TQq84xX6vkwR0Qs1qH5ADkP+MvH0W+9E7TdHJsoIQiM=" crossorigin="anonymous"></script>
    
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>

  <body>
    <header class="navbar">
	 
    <div class="container">
        <nav class="navbar">
	    <div class="container-fluid">
	    <div class="navbar-header">
		<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#menu" aria-expanded="false">
		    <span class="sr-only">Toggle navigation</span>
		    <img src="/assets/img/icons/icon-menu.svg" alt="Toggle navigation" class="navbar-top-align">
		</button>
		<a href="/" class="navbar-brand">
		    <img src="/assets/img/fortran_logo_256x256.png" id="navbar-logo" alt="Fortran">
		</a>
	    </div>
	    <div class="collapse navbar-collapse navbar-top-align" id="menu">
	        <ul class="nav navbar-nav navbar-right">
		
		    
		    <li class="current">
		    
		    <a href="/learn/">Learn</a>
		    
			</li>
		
		    
		    <li>
		    
		    <a href="/compilers/">Compilers</a>
		    
			</li>
		
		    
		    <li>
		    
		    <a href="/community/">Community</a>
		    
			</li>
		
		    
		    <li>
		    
		    <a href="/packages">Packages</a>
		    
			</li>
		
		    
		    <li>
		    
		    <a href="/news/">News</a>
		    
			</li>
		
		<li>
			<a  href="https://fortran-lang.discourse.group/" target="_blank">
			<i class="fab fa-discourse"></i> <i class="icon-link" >Discourse</i>
			</a>
		</li>
		<li>
			<a href="https://twitter.com/fortranlang" target="_blank">
				<i class="fab fa-twitter"></i> <i class="icon-link" >Twitter</i>
			</a>
		</li>
		<li>
			<a  href="https://github.com/fortran-lang" target="_blank">
				<i class="fab fa-github"></i> <i class="icon-link" >Github</i>
			</a>
		</li>
		<li>
			<a  href="/news.xml" target="_blank">
				<i class="fas fa-rss"></i> <i class="icon-link" >RSS Feed</i>
			</a>
		</li>
		</ul>
	    </div>
	    </div>
        </nav>
    </div>
</header>


<section class="front-section">
  <div class="container">

    <div class="col-fixed" id="pagenav-sidebar">

  <!-- Find parent book using page.permalink -->
  <!-- NB. This search is inefficient but simplifies
        the definition of book pages in learning.yml -->
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
  
    
    
      
        
      
        
      
        
      
        
      
        
          
          
    
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
  

  <a href="/learn#book-index">
    <i class="fas fa-arrow-circle-left"></i>
    Back to Learn Fortran index 
  </a>

  <h3>
  <i class="fas fa-book"></i>
  Building programs</h3>

  <div class="content">
   <!-- If this book has multiple pages -->

    

    <ul>
    
    <!-- Add link to book introduction (index) -->
    
      <li><a href="/learn/building_programs">
        Introduction</a></li>
    

    <!-- List pages in this book -->
    
    
      <!-- Get page title from page metadata -->
      
        
      
        
      
        
      
        
      
        
      
        
      
        
          
          

      
        <li><a href="/learn/building_programs/compiling_source">
          Compiling the source code</a></li>
      

    
    
      <!-- Get page title from page metadata -->
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
          
          

      
        <li><a href="/learn/building_programs/linking_pieces">
          Linking the objects</a></li>
      

    
    
      <!-- Get page title from page metadata -->
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
          
          

      
        <li><a href="/learn/building_programs/runtime_libraries">
          Run-time libraries</a></li>
      

    
    
      <!-- Get page title from page metadata -->
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
          
          

      
        <li><a href="/learn/building_programs/include_files">
          Include files and modules</a></li>
      

    
    
      <!-- Get page title from page metadata -->
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
          
          

      
        <li>
          <b><a href="/learn/building_programs/managing_libraries">
            Managing libraries (static and dynamic libraries)</a></b>
          <ul id="page-nav"></ul>
        </li>
        
        
        
      

    
    
      <!-- Get page title from page metadata -->
      
        
      
        
      
        
      
        
          
          

      
        <li><a href="/learn/building_programs/build_tools">
          Build tools</a></li>
      

    
    
      <!-- Get page title from page metadata -->
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
          
          

      
        <li><a href="/learn/building_programs/distributing">
          Distributing your programs</a></li>
      

    
    </ul>

  
</div>

</div>



    <div class="newsletter col-right">

      <h1>Managing libraries (static and dynamic libraries)</h1>

      <div style="margin-top: 0.5em; margin-bottom: 0.5em;">
        <i></i>
        
      </div>

      <p>If you need to manage a program built of dozens of source files (and
that is not uncommon!), the command-line needed to specify all the
object files will be very long indeed. This soon becomes tedious or
even impossible to maintain. So a different solution is called for:
create your own libraries.</p>

<p>Libraries contain any number of object files in a compact form, so that
the command-line becomes far shorter:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>gfortran <span class="nt">-o</span> tabulate tabulate.f90 functions.o supportlib.a
</code></pre></div></div>

<p>where “supportlib.a” is a collection of one, two or many object files,
all compiled and then put into a library. The extension “.a” is used by
Linux and Linux-like platforms. On Windows the extension “.lib” is used.</p>

<p>Creating your own libraries is not that complicated: 
on Linux, you can achieve this using a utility like <code class="highlighter-rouge">ar</code>:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>gfortran <span class="nt">-c</span> file1.f90 file2.f90
<span class="nv">$ </span>gfortran <span class="nt">-c</span> file3.f90 ...
<span class="nv">$ </span>ar r supportlib.a file1.o file2.o
<span class="nv">$ </span>ar r supportlib.a file3.o ...
</code></pre></div></div>

<p>or on Windows using the <code class="highlighter-rouge">lib</code> utility:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>c:<span class="se">\.</span>..&gt; ifort <span class="nt">-c</span> file1.f90 file2.f90
c:<span class="se">\.</span>..&gt; ifort <span class="nt">-c</span> file3.f90 ...
c:<span class="se">\.</span>..&gt; lib /out:supportlib.lib file1.obj file2.obj
c:<span class="se">\.</span>..&gt; lib supportlib.lib file3.obj ...
</code></pre></div></div>

<p>Note:</p>

<ul>
  <li>The command <code class="highlighter-rouge">ar</code> with the option <code class="highlighter-rouge">r</code> either creates the library (the
name appears after the option) or adds new object files to the library
(or replaces any existing ones).</li>
  <li>The command <code class="highlighter-rouge">lib</code> will create a new library if you use specify the
option <code class="highlighter-rouge">/out:</code> with the name of the new library next to it. To add
object files to an existing library, leave out the <code class="highlighter-rouge">/out:</code> bit.</li>
  <li>On platforms like Linux there is a particular convention to name
libraries. If you name your library like “libname.a” (note the “lib”
prefix), then you can refer to it as <code class="highlighter-rouge">-lname</code> in the link step.</li>
  <li>Libraries are often sought in directories indicated by an option <code class="highlighter-rouge">-L</code>
or <code class="highlighter-rouge">/LIBPATH</code>. This saves you from having to specify the exact path for
every library.</li>
</ul>

<p>Using libraries you can build very large programs without
having to resort to extremely long command lines.</p>

<h2 id="static-versus-dynamic-libraries">Static versus dynamic libraries</h2>

<p>The above discussion is tacitly assuming that you are using the so-called
static libraries. Static libraries (or at least parts of their
contents) become an integral part of the executable program. The only
way to change the routines incorporated in the program is by rebuilding
the program with a new version of the library.</p>

<p>A flexible alternative is to use the so-called dynamic libraries. These
libraries remain outside the executable program and as a consequence
can be replaced without rebulding the entire program. Compilers and
indeed the operating system itself rely heavily on such dynamic
libraries. You could consider dynamic libraries as a sort of executable
programs that need a bit of help to be run.</p>

<p>Building dynamic libraries works slightly differently from building
static libraries: you use the compiler/linker instead of a tool
like <code class="highlighter-rouge">ar</code> or <code class="highlighter-rouge">lib</code>.</p>

<p>On Linux:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>gfortran <span class="nt">-fpic</span> <span class="nt">-c</span> file1.f90 file2.f90
<span class="nv">$ </span>gfortran <span class="nt">-fpic</span> <span class="nt">-c</span> file3.f90 ...
<span class="nv">$ </span>gfortran <span class="nt">-shared</span> <span class="nt">-o</span> supportlib.so file1.o file2.o file3.o ...
</code></pre></div></div>

<p>On Windows, with the Intel Fortran compiler:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>ifort <span class="nt">-c</span> file1.f90 file2.f90
<span class="nv">$ </span>ifort <span class="nt">-c</span> file3.f90 ...
<span class="nv">$ </span>ifort <span class="nt">-dll</span> <span class="nt">-exe</span>:supportlib.dll file1.obj file2.obj file3.obj ...
</code></pre></div></div>

<p>The differences are that:</p>

<ul>
  <li>You need to specify a compile option on Linux, for gfortran that is <code class="highlighter-rouge">-fpic</code>,
because the object code is slightly different.</li>
  <li>You need to tell in the link step that you want a dynamic library (on
Linux: a shared object/library, hence the extension “.so”; on Windows:
a dynamic link library)</li>
</ul>

<p>There is one more thing to be aware of: On Windows you must
explicitly specify that a procedure is to be <em>exported</em>, i.e. is visible
in the dynamic library. There are several ways — depending on the
compiler you use — to achieve this. One method is via a so-called
compiler directive:</p>

<div class="language-fortran highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">subroutine</span><span class="w"> </span><span class="n">myroutine</span><span class="p">(</span><span class="w"> </span><span class="err">...</span><span class="w"> </span><span class="p">)</span><span class="w">
</span><span class="c1">!GCC$ ATTRIBUTES DLLEXPORT:: myroutine</span><span class="w">
</span></code></pre></div></div>

<p>Or, with the Intel Fortran compiler:</p>

<div class="language-fortran highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">subroutine</span><span class="w"> </span><span class="n">myroutine</span><span class="p">(</span><span class="w"> </span><span class="err">...</span><span class="w"> </span><span class="p">)</span><span class="w">
</span><span class="c1">!DEC$ ATTRIBUTES DLLEXPORT:: myroutine</span><span class="w">
</span></code></pre></div></div>

<p>Besides a dynamic library (DLL), a so-called import library may be
generated.</p>

<p>Because the details differ per compiler, here are two examples:
gfortran on Cygwin and Intel Fortran on Windows. In both cases
we look at the <code class="highlighter-rouge">tabulate</code> program in the file “tabulate.f90”.</p>

<h2 id="gnulinux-and-gfortran">GNU/Linux and gfortran</h2>
<p>The <code class="highlighter-rouge">tabulate</code> program requires a user-defined routine <code class="highlighter-rouge">f</code>. If we
let it reside in a dynamic library, say “functions.dll”, we can simply
replace the implementation of the function by putting another dynamic
library in the directory. No need to rebuild the program as such.</p>

<p>On Cygwin it is not necessary to explicitly export a procedure — all
publically visible routines are exported when you build a dynamic library.
Also, no import library is generated.</p>

<p>Since our dynamic library can be built from a single source file, we
can take a shortcut:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>gfortran <span class="nt">-shared</span> <span class="nt">-o</span> functions.dll functions.f90
</code></pre></div></div>

<p>This produces the files “functions.dll” and “user_functions.mod”. The
utility <code class="highlighter-rouge">nm</code> tells us the exact name of the function <code class="highlighter-rouge">f</code>:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>nm functions.dll
...
000000054f9d7000 B __dynamically_loaded
                 U __end__
0000000000000200 A __file_alignment__
000000054f9d1030 T __function_MOD_f
000000054f9d1020 T __gcc_deregister_frame
000000054f9d1000 T __gcc_register_frame
...
</code></pre></div></div>

<p>It has received a prefix <code class="highlighter-rouge">__function_MOD_</code> to distinguish it from any
other routine “f” that might be defined in another module.</p>

<p>The next step is to build the program:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>gfortran <span class="nt">-o</span> tabulate tabulate.f90 functions.dll
</code></pre></div></div>

<p>The DLL and the .mod file are used to build the executable program
with checks on the function’s interface, the right name and the reference
to “a” DLL, called “functions.dll”.</p>

<p>You can replace the shared library “functions.dll” by another one, implementing
a different function “f”. Of course, you need to be careful to use the correct
interface for this function. The compiler/linker are not invoked anymore, so they
can do no checking.</p>

<h2 id="windows-and-intel-fortran">Windows and Intel Fortran</h2>
<p>The setup is the same as with Linux, but on Windows it is necessary
to explicitly export the routines. And an import library is generated —
this is the library that should be used in the link step.</p>

<p>The source file must contain the compiler directive, otherwise the function <code class="highlighter-rouge">f</code>
is not exported:</p>

<div class="language-fortran highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">real</span><span class="w"> </span><span class="k">function</span><span class="w"> </span><span class="n">f</span><span class="p">(</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="p">)</span><span class="w">
</span><span class="c1">!DEC$ ATTRIBUTES DLLEXPORT :: f</span><span class="w">
</span></code></pre></div></div>

<p>Again we take a shortcut:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>ifort <span class="nt">-exe</span>:functions.dll functions.f90 <span class="nt">-dll</span>
</code></pre></div></div>

<p>This produces the files “functions.dll”, “user_functions.mod” as well as “functions.lib” (and two
other files of no importance here). The “dependency walker” program tells us
that the exact name of the function “f” is <code class="highlighter-rouge">FUNCTION_mp_F</code>. It is also exported, so that
it can be found by the linker in the next step:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ ifort tabulate.f90 functions.lib
</code></pre></div></div>

<p>Note that we need to specify the name of the export library, not the DLL!</p>

<p>(Note also: the Intel Fortran compiler uses the name of the first source file as the
name for the executable — here we do without the <code class="highlighter-rouge">-exe</code> option.)</p>

<p>Just as under Cygwin, the DLL and the .mod file are used to build the executable program
with checks on the function’s interface, the right name and the reference
to “a” DLL, called “functions.dll”.</p>

<p>You can replace the shared library “functions.dll” by another one, but the same
caution is required: while the implementation can be quite different, the
function’s interface must be the same.</p>


      <div class="container-flex">

        
          
            <a href="/learn/building_programs/include_files" style="margin-right: auto;">
          
            <h3><i class="fas fa-arrow-circle-left"></i>
              Back
            </h3>
          </a>
        

        
          
          <a href="/learn/building_programs/build_tools"
          style="margin-left: auto;">
            <h3>
              Next
              <i class="fas fa-arrow-circle-right"></i>
            </h3>
          </a>
          
        

      </div>

    </div>

  </div>
</section>


    <footer>
  <div class="container">
    <div class="col-wide">
    
      <a href="/learn/">Learn</a>
      
        &middot;
      
    
      <a href="/compilers/">Compilers</a>
      
        &middot;
      
    
      <a href="/community/">Community</a>
      
        &middot;
      
    
      <a href="/packages">Packages</a>
      
        &middot;
      
    
      <a href="/news/">News</a>
      
    
    </div>

    <div class="col-narrow">
      This site's source is <a href="https://github.com/fortran-lang/fortran-lang.github.io/">hosted on GitHub</a>.
    </div>
  </div>
</footer>


    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.0/jquery-ui.min.js"></script>
     

    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
    <script src="/assets/js/fortranlang.js"></script>
    <script src="/assets/js/page_nav.js"></script>
    <script src="/assets/js/gh-contributors.js"></script>
    <script src="/assets/js/package_search.js"></script>
    <script src="/assets/js/package_tags.js"></script>
    <script>
      feather.replace()
    </script>
  </body>
</html>
