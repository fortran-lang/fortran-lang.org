
<!DOCTYPE html>

<html lang="None">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Static versus dynamic libraries &#8212; Fortran-lang.org website 1.0.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/alabaster.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/design-tabs.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />
  
<style type="text/css">
  ul.ablog-archive {
    list-style: none;
    overflow: auto;
    margin-left: 0px;
  }
  ul.ablog-archive li {
    float: left;
    margin-right: 5px;
    font-size: 80%;
  }
  ul.postlist a {
    font-style: italic;
  }
  ul.postlist-style-disc {
    list-style-type: disc;
  }
  ul.postlist-style-none {
    list-style-type: none;
  }
  ul.postlist-style-circle {
    list-style-type: circle;
  }
</style>

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
             <p>If you need to manage a program built of dozens of source files (and
that is not uncommon!), the command-line needed to specify all the
object files will be very long indeed. This soon becomes tedious or
even impossible to maintain. So a different solution is called for:
create your own libraries.</p>
<p>Libraries contain any number of object files in a compact form, so that
the command-line becomes far shorter:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ gfortran -o tabulate tabulate.f90 functions.o supportlib.a
</pre></div>
</div>
<p>where &quot;supportlib.a&quot; is a collection of one, two or many object files,
all compiled and then put into a library. The extension &quot;.a&quot; is used by
Linux and Linux-like platforms. On Windows the extension &quot;.lib&quot; is used.</p>
<p>Creating your own libraries is not that complicated:
on Linux, you can achieve this using a utility like <code class="docutils literal notranslate"><span class="pre">ar</span></code>:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ gfortran -c file1.f90 file2.f90
$ gfortran -c file3.f90 ...
$ ar r supportlib.a file1.o file2.o
$ ar r supportlib.a file3.o ...
</pre></div>
</div>
<p>or on Windows using the <code class="docutils literal notranslate"><span class="pre">lib</span></code> utility:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>c:<span class="se">\.</span>..&gt; ifort -c file1.f90 file2.f90
c:<span class="se">\.</span>..&gt; ifort -c file3.f90 ...
c:<span class="se">\.</span>..&gt; lib /out:supportlib.lib file1.obj file2.obj
c:<span class="se">\.</span>..&gt; lib supportlib.lib file3.obj ...
</pre></div>
</div>
<p>Note:</p>
<ul class="simple">
<li><p>The command <code class="docutils literal notranslate"><span class="pre">ar</span></code> with the option <code class="docutils literal notranslate"><span class="pre">r</span></code> either creates the library (the
name appears after the option) or adds new object files to the library
(or replaces any existing ones).</p></li>
<li><p>The command <code class="docutils literal notranslate"><span class="pre">lib</span></code> will create a new library if you use specify the
option <code class="docutils literal notranslate"><span class="pre">/out:</span></code> with the name of the new library next to it. To add
object files to an existing library, leave out the <code class="docutils literal notranslate"><span class="pre">/out:</span></code> bit.</p></li>
<li><p>On platforms like Linux there is a particular convention to name
libraries. If you name your library like &quot;libname.a&quot; (note the &quot;lib&quot;
prefix), then you can refer to it as <code class="docutils literal notranslate"><span class="pre">-lname</span></code> in the link step.</p></li>
<li><p>Libraries are often sought in directories indicated by an option <code class="docutils literal notranslate"><span class="pre">-L</span></code>
or <code class="docutils literal notranslate"><span class="pre">/LIBPATH</span></code>. This saves you from having to specify the exact path for
every library.</p></li>
</ul>
<p>Using libraries you can build very large programs without
having to resort to extremely long command lines.</p>
<section id="static-versus-dynamic-libraries">
<h1>Static versus dynamic libraries<a class="headerlink" href="#static-versus-dynamic-libraries" title="Permalink to this headline">¶</a></h1>
<p>The above discussion is tacitly assuming that you are using the so-called
static libraries. Static libraries (or at least parts of their
contents) become an integral part of the executable program. The only
way to change the routines incorporated in the program is by rebuilding
the program with a new version of the library.</p>
<p>A flexible alternative is to use the so-called dynamic libraries. These
libraries remain outside the executable program and as a consequence
can be replaced without rebulding the entire program. Compilers and
indeed the operating system itself rely heavily on such dynamic
libraries. You could consider dynamic libraries as a sort of executable
programs that need a bit of help to be run.</p>
<p>Building dynamic libraries works slightly differently from building
static libraries: you use the compiler/linker instead of a tool
like <code class="docutils literal notranslate"><span class="pre">ar</span></code> or <code class="docutils literal notranslate"><span class="pre">lib</span></code>.</p>
<p>On Linux:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ gfortran -fpic -c file1.f90 file2.f90
$ gfortran -fpic -c file3.f90 ...
$ gfortran -shared -o supportlib.so file1.o file2.o file3.o ...
</pre></div>
</div>
<p>On Windows, with the Intel Fortran compiler:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ ifort -c file1.f90 file2.f90
$ ifort -c file3.f90 ...
$ ifort -dll -exe:supportlib.dll file1.obj file2.obj file3.obj ...
</pre></div>
</div>
<p>The differences are that:</p>
<ul class="simple">
<li><p>You need to specify a compile option on Linux, for gfortran that is <code class="docutils literal notranslate"><span class="pre">-fpic</span></code>,
because the object code is slightly different.</p></li>
<li><p>You need to tell in the link step that you want a dynamic library (on
Linux: a shared object/library, hence the extension &quot;.so&quot;; on Windows:
a dynamic link library)</p></li>
</ul>
<p>There is one more thing to be aware of: On Windows you must
explicitly specify that a procedure is to be <em>exported</em>, i.e. is visible
in the dynamic library. There are several ways — depending on the
compiler you use — to achieve this. One method is via a so-called
compiler directive:</p>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="k">subroutine </span><span class="n">myroutine</span><span class="p">(</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<span class="c">!GCC$ ATTRIBUTES DLLEXPORT:: myroutine</span>
</pre></div>
</div>
<p>Or, with the Intel Fortran compiler:</p>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="k">subroutine </span><span class="n">myroutine</span><span class="p">(</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<span class="c">!DEC$ ATTRIBUTES DLLEXPORT:: myroutine</span>
</pre></div>
</div>
<p>Besides a dynamic library (DLL), a so-called import library may be
generated.</p>
<p>Because the details differ per compiler, here are two examples:
gfortran on Cygwin and Intel Fortran on Windows. In both cases
we look at the <code class="docutils literal notranslate"><span class="pre">tabulate</span></code> program in the file &quot;tabulate.f90&quot;.</p>
</section>
<section id="gnu-linux-and-gfortran">
<h1>GNU/Linux and gfortran<a class="headerlink" href="#gnu-linux-and-gfortran" title="Permalink to this headline">¶</a></h1>
<p>The <code class="docutils literal notranslate"><span class="pre">tabulate</span></code> program requires a user-defined routine <code class="docutils literal notranslate"><span class="pre">f</span></code>. If we
let it reside in a dynamic library, say &quot;functions.dll&quot;, we can simply
replace the implementation of the function by putting another dynamic
library in the directory. No need to rebuild the program as such.</p>
<p>On Cygwin it is not necessary to explicitly export a procedure — all
publically visible routines are exported when you build a dynamic library.
Also, no import library is generated.</p>
<p>Since our dynamic library can be built from a single source file, we
can take a shortcut:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ gfortran -shared -o functions.dll functions.f90
</pre></div>
</div>
<p>This produces the files &quot;functions.dll&quot; and &quot;user_functions.mod&quot;. The
utility <code class="docutils literal notranslate"><span class="pre">nm</span></code> tells us the exact name of the function <code class="docutils literal notranslate"><span class="pre">f</span></code>:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ nm functions.dll
...
000000054f9d7000 B __dynamically_loaded
                 U __end__
<span class="m">0000000000000200</span> A __file_alignment__
000000054f9d1030 T __function_MOD_f
000000054f9d1020 T __gcc_deregister_frame
000000054f9d1000 T __gcc_register_frame
...
</pre></div>
</div>
<p>It has received a prefix <code class="docutils literal notranslate"><span class="pre">__function_MOD_</span></code> to distinguish it from any
other routine &quot;f&quot; that might be defined in another module.</p>
<p>The next step is to build the program:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ gfortran -o tabulate tabulate.f90 functions.dll
</pre></div>
</div>
<p>The DLL and the .mod file are used to build the executable program
with checks on the function's interface, the right name and the reference
to &quot;a&quot; DLL, called &quot;functions.dll&quot;.</p>
<p>You can replace the shared library &quot;functions.dll&quot; by another one, implementing
a different function &quot;f&quot;. Of course, you need to be careful to use the correct
interface for this function. The compiler/linker are not invoked anymore, so they
can do no checking.</p>
</section>
<section id="windows-and-intel-fortran">
<h1>Windows and Intel Fortran<a class="headerlink" href="#windows-and-intel-fortran" title="Permalink to this headline">¶</a></h1>
<p>The setup is the same as with Linux, but on Windows it is necessary
to explicitly export the routines. And an import library is generated —
this is the library that should be used in the link step.</p>
<p>The source file must contain the compiler directive, otherwise the function <code class="docutils literal notranslate"><span class="pre">f</span></code>
is not exported:</p>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="kt">real </span><span class="k">function </span><span class="n">f</span><span class="p">(</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<span class="c">!DEC$ ATTRIBUTES DLLEXPORT :: f</span>
</pre></div>
</div>
<p>Again we take a shortcut:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ ifort -exe:functions.dll functions.f90 -dll
</pre></div>
</div>
<p>This produces the files &quot;functions.dll&quot;, &quot;user_functions.mod&quot; as well as &quot;functions.lib&quot; (and two
other files of no importance here). The &quot;dependency walker&quot; program tells us
that the exact name of the function &quot;f&quot; is <code class="docutils literal notranslate"><span class="pre">FUNCTION_mp_F</span></code>. It is also exported, so that
it can be found by the linker in the next step:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ifort tabulate.f90 functions.lib
</pre></div>
</div>
<p>Note that we need to specify the name of the export library, not the DLL!</p>
<p>(Note also: the Intel Fortran compiler uses the name of the first source file as the
name for the executable — here we do without the <code class="docutils literal notranslate"><span class="pre">-exe</span></code> option.)</p>
<p>Just as under Cygwin, the DLL and the .mod file are used to build the executable program
with checks on the function's interface, the right name and the reference
to &quot;a&quot; DLL, called &quot;functions.dll&quot;.</p>
<p>You can replace the shared library &quot;functions.dll&quot; by another one, but the same
caution is required: while the implementation can be quite different, the
function's interface must be the same.</p>
</section>

<div class="section">
   
</div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">Fortran-lang.org website</a></h1>








<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../learn/index.html">Learn</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2022, Fortran Community.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 4.5.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../../_sources/learn_website/building_programs/managing_libraries.md.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>