
<!DOCTYPE html>

<html lang="None">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Using make as build tool &#8212; Fortran-lang.org website 1.0.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/alabaster.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/design-tabs.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />
  
<style type="text/css">
  ul.ablog-archive {
    list-style: none;
    overflow: auto;
    margin-left: 0px;
  }
  ul.ablog-archive li {
    float: left;
    margin-right: 5px;
    font-size: 80%;
  }
  ul.postlist a {
    font-style: italic;
  }
  ul.postlist-style-disc {
    list-style-type: disc;
  }
  ul.postlist-style-none {
    list-style-type: none;
  }
  ul.postlist-style-circle {
    list-style-type: circle;
  }
</style>

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
             <p>Compiling your Fortran projects by hand can become quite complicated depending
on the number of source files and the interdependencies through the module.
Supporting different compilers and linkers or different platforms can become
increasingly complicated unless the right tools are used to automatically
perform those tasks.</p>
<p>Depending on the size of your project and the purpose of project different
options for the build automation can be used.</p>
<p>First, your integrated development environment probably provides a way to build
your program. A popular cross-platform  tool is Microsoft's
<a href="https://code.visualstudio.com/" target="_blank" rel="noopener">Visual Studio Code</a>,
but others exist, such as
<a href="https://atom.io/" target="_blank" rel="noopener">Atom</a>,
<a href="https://www.eclipse.org/photran/" target="_blank" rel="noopener">Eclipse Photran</a>,
and <a href="http://www.codeblocks.org/" target="_blank" rel="noopener">Code::Blocks</a>.
They offer a graphical user-interface, but are often very specific for the
compiler and platform.</p>
<p>For smaller projects, the rule based build system <code class="docutils literal notranslate"><span class="pre">make</span></code> is a common
choice. Based on the rules defined it can perform task like (re)compiling
object files from updated source files, creating libraries and linking
executables.
To use <code class="docutils literal notranslate"><span class="pre">make</span></code> for your project you have to encode those rules in <code class="docutils literal notranslate"><span class="pre">Makefile</span></code>,
which defines the interdependencies of all the final program, the intermediary
object files or libraries and the actual source files.
For a short introduction see <span class="xref myst">the guide on <code class="docutils literal notranslate"><span class="pre">make</span></code></span>.</p>
<p>Maintenance tools like autotools and CMake can generate Makefiles or
Visual Studio project files via a high-level description. They abstract
away from the compiler and platform specifics.</p>
<p>Which of those tools are the best choice for your projects depends on many factors.
Choose a build tool you are comfortable working with, it should not get in your
way while developing. Spending more time on working against your build tools
than doing actual development work can quickly become frustrating.</p>
<p>Also, consider the accessibility of your build tools.
If it is restricted to a specific integrated development environment, can all
developers on your project access it?
If you are using a specific build system, does it work on all platforms you
are developing for?
How large is the entry barrier of your build tools? Consider the learning curve
for the build tools, the perfect build tool will be of no use, if you have to
learn a complex programming language first to add a new source file.
Finally, consider what other project are using, those you are depending on and
those that use (or will use) your project as dependency.</p>
<section id="using-make-as-build-tool">
<h1>Using make as build tool<a class="headerlink" href="#using-make-as-build-tool" title="Permalink to this headline">Â¶</a></h1>
<p>The most well-known and commonly used build system is called <code class="docutils literal notranslate"><span class="pre">make</span></code>.
It performs actions following rules defined in a configuration file
called <code class="docutils literal notranslate"><span class="pre">Makefile</span></code> or <code class="docutils literal notranslate"><span class="pre">makefile</span></code>, which usually leads to compiling a program
from the provided source code.</p>
<p>{% include tip.html
content=&quot;For an in-depth <code class="docutils literal notranslate"><span class="pre">make</span></code> tutorial lookup its info page. There is an online version of this &lt;a href=&quot;https://www.gnu.org/software/make/manual/make.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;info page</a>, available.&quot;</p>
<p>We will start with the basics from your clean source directory. Create and open
the file <code class="docutils literal notranslate"><span class="pre">Makefile</span></code>, we start with a simple rule called <em>all</em>:</p>
<div class="highlight-make notranslate"><div class="highlight"><pre><span></span><span class="nf">all</span><span class="o">:</span>
	<span class="nb">echo</span> <span class="s2">&quot;</span><span class="nv">$@</span><span class="s2">&quot;</span>
</pre></div>
</div>
<p>After saving the <code class="docutils literal notranslate"><span class="pre">Makefile</span></code> run it by executing <code class="docutils literal notranslate"><span class="pre">make</span></code> in the same directory.
You should see the following output:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>echo &quot;all&quot;
all
</pre></div>
</div>
<p>First, we note that <code class="docutils literal notranslate"><span class="pre">make</span></code> is substituting <code class="docutils literal notranslate"><span class="pre">$&#64;</span></code> for the name of the rule,
the second thing to note is that <code class="docutils literal notranslate"><span class="pre">make</span></code> is always printing the command it is
running, finally, we see the result of running <code class="docutils literal notranslate"><span class="pre">echo</span> <span class="pre">&quot;all&quot;</span></code>.</p>
<p>{% include note.html
content=&quot;We call the entry point of our <code class="docutils literal notranslate"><span class="pre">Makefile</span></code> always <em>all</em> by convention, but you can choose whatever name you like.&quot;</p>
<p>{% capture note %}</p>
<p>You should not have noticed it if your editor is working correctly,
but you have to indent the content of a rule with a tab character.
In case you have problems running the above <code class="docutils literal notranslate"><span class="pre">Makefile</span></code> and see an error like</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Makefile:2: *** missing separator.  Stop.
</pre></div>
</div>
<p>The indentation is probably not correct. In this case replace the indentation
in the second line with a tab character.</p>
<p>{% endcapture %}
{% include note.html title=&quot;Note&quot; content=note %}</p>
<p>Now we want to make our rules more complicated, therefore we add another rule:</p>
<div class="highlight-make notranslate"><div class="highlight"><pre><span></span><span class="nv">PROG</span> <span class="o">:=</span> my_prog

<span class="nf">all</span><span class="o">:</span> <span class="k">$(</span><span class="nv">PROG</span><span class="k">)</span>
	<span class="nb">echo</span> <span class="s2">&quot;</span><span class="nv">$@</span><span class="s2"> depends on </span>$<span class="s2">^&quot;</span>

<span class="nf">$(PROG)</span><span class="o">:</span>
	<span class="nb">echo</span> <span class="s2">&quot;</span><span class="nv">$@</span><span class="s2">&quot;</span>
</pre></div>
</div>
<p>Note how we declare variables in <code class="docutils literal notranslate"><span class="pre">make</span></code>, you should always declare your local
variables with <code class="docutils literal notranslate"><span class="pre">:=</span></code>. To access the content of a variable we use the <code class="docutils literal notranslate"><span class="pre">$(...)</span></code>,
note that we have to enclose the variable name in parenthesis.</p>
<p>{% capture note %}</p>
<p>The declaration of variables is usually done with <code class="docutils literal notranslate"><span class="pre">:=</span></code>, but <code class="docutils literal notranslate"><span class="pre">make</span></code> does
support <em>recursively expanded</em> variables as well with <code class="docutils literal notranslate"><span class="pre">=</span></code>.
Normally, the first kind of declaration is wanted, as they are more predictable
and do not have a runtime overhead from the recursive expansion.
{% endcapture %}
{% include note.html title=&quot;Note&quot; content=note %}</p>
<p>We introduced a dependency of the rule all, namely the content of the variable
<code class="docutils literal notranslate"><span class="pre">PROG</span></code>, also we modified the printout, we want to see all the dependencies
of this rule, which are stored in the variable <code class="docutils literal notranslate"><span class="pre">$^</span></code>.
Now for the new rule which we name after the value of the variable <code class="docutils literal notranslate"><span class="pre">PROG</span></code>,
it does the same thing we did before for the rule <em>all</em>, note how the value
of <code class="docutils literal notranslate"><span class="pre">$&#64;</span></code> is dependent on the rule it is used in.</p>
<p>Again check by running the <code class="docutils literal notranslate"><span class="pre">make</span></code>, you should see:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>echo &quot;my_prog&quot;
my_prog
echo &quot;all depends on my_prog&quot;
all depends on my_prog
</pre></div>
</div>
<p>The dependency has been correctly resolved and evaluated before performing
any action on the rule <em>all</em>.
Let's run only the second rule: type <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">my_prog</span></code> and you will only find
the first two lines in your terminal.</p>
<p>The next step is to perform some real actions with <code class="docutils literal notranslate"><span class="pre">make</span></code>, we take
the source code from the previous chapter here and add new rules to our
<code class="docutils literal notranslate"><span class="pre">Makefile</span></code>:</p>
<div class="highlight-make notranslate"><div class="highlight"><pre><span></span><span class="nv">OBJS</span> <span class="o">:=</span> tabulate.o functions.o
<span class="nv">PROG</span> <span class="o">:=</span> my_prog

<span class="nf">all</span><span class="o">:</span> <span class="k">$(</span><span class="nv">PROG</span><span class="k">)</span>

<span class="nf">$(PROG)</span><span class="o">:</span> <span class="k">$(</span><span class="nv">OBJS</span><span class="k">)</span>
	gfortran -o <span class="nv">$@</span> $^

<span class="nf">$(OBJS)</span><span class="o">:</span> %.<span class="n">o</span>: %.<span class="n">f</span>90
	gfortran -c -o <span class="nv">$@</span> $&lt;
</pre></div>
</div>
<p>We define <code class="docutils literal notranslate"><span class="pre">OBJS</span></code> which stands for object files, our program depends on
those <code class="docutils literal notranslate"><span class="pre">OBJS</span></code> and for each object file we create a rule to make them from
a source file.
The last rule we introduced is a pattern matching rule, <code class="docutils literal notranslate"><span class="pre">%</span></code> is the common
pattern between <code class="docutils literal notranslate"><span class="pre">tabulate.o</span></code> and <code class="docutils literal notranslate"><span class="pre">tabulate.f90</span></code>, which connects our object file
<code class="docutils literal notranslate"><span class="pre">tabulate.o</span></code> to the source file <code class="docutils literal notranslate"><span class="pre">tabulate.f90</span></code>.
With this set, we run our compiler, here <code class="docutils literal notranslate"><span class="pre">gfortran</span></code> and translate the source
file into an object file, we do not create an executable yet due to the <code class="docutils literal notranslate"><span class="pre">-c</span></code>
flag.
Note the usage of the <code class="docutils literal notranslate"><span class="pre">$&lt;</span></code> for the first element of the dependencies here.</p>
<p>After compiling all the object files we attempt to link the program, we do not
use a linker directly, but <code class="docutils literal notranslate"><span class="pre">gfortran</span></code> to produce the executable.</p>
<p>Now we run the build script with <code class="docutils literal notranslate"><span class="pre">make</span></code>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>gfortran -c -o tabulate.o tabulate.f90
tabulate.f90:2:7:

    2 |    use user_functions
      |       1
Fatal Error: Cannot open module file âuser_functions.modâ for reading at (1): No such file or directory
compilation terminated.
make: *** [Makefile:10: tabulate.f90.o] Error 1
</pre></div>
</div>
<p>We remember that we have dependencies between our source files, therefore we add
this dependency explicitly to the <code class="docutils literal notranslate"><span class="pre">Makefile</span></code> with</p>
<div class="highlight-make notranslate"><div class="highlight"><pre><span></span><span class="nf">tabulate.o</span><span class="o">:</span> <span class="n">functions</span>.<span class="n">o</span>
</pre></div>
</div>
<p>Now we can retry and find that the build is working correctly. The output should
look like</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>gfortran -c -o functions.o functions.f90
gfortran -c -o tabulate.o tabulate.f90
gfortran -o my_prog tabulate.o functions.o
</pre></div>
</div>
<p>You should find <em>four</em> new files in the directory now.
Run <code class="docutils literal notranslate"><span class="pre">my_prog</span></code> to make sure everything works as expected.
Let's run <code class="docutils literal notranslate"><span class="pre">make</span></code> again:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>make: Nothing to be done for &#39;all&#39;.
</pre></div>
</div>
<p>Using the timestamps of the executable <code class="docutils literal notranslate"><span class="pre">make</span></code> was able to determine, it is
newer than both <code class="docutils literal notranslate"><span class="pre">tabulate.o</span></code> and <code class="docutils literal notranslate"><span class="pre">functions.o</span></code>, which in turn are newer than
<code class="docutils literal notranslate"><span class="pre">tabulate.f90</span></code> and <code class="docutils literal notranslate"><span class="pre">functions.f90</span></code>.
Therefore, the program is already up-to-date with the latest code and no
action has to be performed.</p>
<p>In the end, we will have a look at a complete <code class="docutils literal notranslate"><span class="pre">Makefile</span></code>.</p>
<div class="highlight-make notranslate"><div class="highlight"><pre><span></span><span class="c"># Disable all of make&#39;s built-in rules (similar to Fortran&#39;s implicit none)</span>
<span class="nv">MAKEFLAGS</span> <span class="o">+=</span> --no-builtin-rules --no-builtin-variables
<span class="c"># configuration</span>
<span class="nv">FC</span> <span class="o">:=</span> gfortran
<span class="nv">LD</span> <span class="o">:=</span> <span class="k">$(</span>FC<span class="k">)</span>
<span class="nv">RM</span> <span class="o">:=</span> rm -f
<span class="c"># list of all source files</span>
<span class="nv">SRCS</span> <span class="o">:=</span> tabulate.f90 functions.f90
<span class="nv">PROG</span> <span class="o">:=</span> my_prog

<span class="nv">OBJS</span> <span class="o">:=</span> <span class="k">$(</span>addsuffix .o, <span class="k">$(</span>SRCS<span class="k">))</span>

<span class="nf">.PHONY</span><span class="o">:</span> <span class="n">all</span> <span class="n">clean</span>
<span class="nf">all</span><span class="o">:</span> <span class="k">$(</span><span class="nv">PROG</span><span class="k">)</span>

<span class="nf">$(PROG)</span><span class="o">:</span> <span class="k">$(</span><span class="nv">OBJS</span><span class="k">)</span>
	<span class="k">$(</span>LD<span class="k">)</span> -o <span class="nv">$@</span> $^

<span class="nf">$(OBJS)</span><span class="o">:</span> %.<span class="n">o</span>: %
	<span class="k">$(</span>FC<span class="k">)</span> -c -o <span class="nv">$@</span> $&lt;

<span class="c"># define dependencies between object files</span>
<span class="nf">tabulate.f90.o</span><span class="o">:</span> <span class="n">functions</span>.<span class="n">f</span>90.<span class="n">o</span> <span class="n">user_functions</span>.<span class="n">mod</span>

<span class="c"># rebuild all object files in case this Makefile changes</span>
<span class="nf">$(OBJS)</span><span class="o">:</span> <span class="k">$(</span><span class="nv">MAKEFILE_LIST</span><span class="k">)</span>

<span class="nf">clean</span><span class="o">:</span>
	<span class="k">$(</span>RM<span class="k">)</span> <span class="k">$(</span>filter %.o, <span class="k">$(</span>OBJS<span class="k">))</span> <span class="k">$(</span>wildcard *.mod<span class="k">)</span> <span class="k">$(</span>PROG<span class="k">)</span>
</pre></div>
</div>
<p>Since you are starting with <code class="docutils literal notranslate"><span class="pre">make</span></code> we highly recommend to always include
the first line, like with Fortran's <code class="docutils literal notranslate"><span class="pre">implicit</span> <span class="pre">none</span></code> we do not want to have
implicit rules messing up our <code class="docutils literal notranslate"><span class="pre">Makefile</span></code> in surprising and harmful ways.</p>
<p>Next, we have a configuration section where we define variables, in case you
want to switch out your compiler, it can be easily done here.
We also introduced the <code class="docutils literal notranslate"><span class="pre">SRCS</span></code> variable to hold all source files, which is
more intuitive than specifying object files.
We can easily create the object files by appending a <code class="docutils literal notranslate"><span class="pre">.o</span></code> suffix using the
functions <code class="docutils literal notranslate"><span class="pre">addsuffix</span></code>.
The <code class="docutils literal notranslate"><span class="pre">.PHONY</span></code> is a special rule, which should be used for all entry points
of your <code class="docutils literal notranslate"><span class="pre">Makefile</span></code>, here we define two entry point, we already know <em>all</em>,
the new <em>clean</em> rule deletes all the build artifacts again such that we indeed
start with a clean directory.</p>
<p>Also, we slightly changed the build rule for the object files to account for
appending the <code class="docutils literal notranslate"><span class="pre">.o</span></code> suffix instead of substituting it.
Notice that we still need to explicitly define the interdependencies in the
<code class="docutils literal notranslate"><span class="pre">Makefile</span></code>. We also added a dependency for the object files on the <code class="docutils literal notranslate"><span class="pre">Makefile</span></code>
itself, in case you change the compiler, this will allow you to safely rebuild.</p>
<p>Now you know enough about <code class="docutils literal notranslate"><span class="pre">make</span></code> to use it for building small projects.
If you plan to use <code class="docutils literal notranslate"><span class="pre">make</span></code> more extensively, we have compiled a few tips
for you as well.</p>
<p>{% capture note %}</p>
<p>In this guide, we avoided and disabled a lot of the commonly used <code class="docutils literal notranslate"><span class="pre">make</span></code>
features that can be particularly troublesome if not used correctly, we highly
recommend staying away from the builtin rules and variables if you do not feel
confident working with <code class="docutils literal notranslate"><span class="pre">make</span></code>, but explicitly declare all variables and rules.</p>
<p>You will find that <code class="docutils literal notranslate"><span class="pre">make</span></code> is capable tool to automate short interdependent
workflows and to build small projects. But for larger projects, you will
probably soon run against some of it limitations. Usually, <code class="docutils literal notranslate"><span class="pre">make</span></code> is therefore
not used alone but combined with other tools to generate the <code class="docutils literal notranslate"><span class="pre">Makefile</span></code>
completely or in parts.
{% endcapture %}
{% include note.html title=&quot;Note&quot; content=note %}</p>
<section id="recursively-expanded-variables">
<h2>Recursively expanded variables<a class="headerlink" href="#recursively-expanded-variables" title="Permalink to this headline">Â¶</a></h2>
<p>Commonly seen in many projects are recursively expanded variables (declared with
<code class="docutils literal notranslate"><span class="pre">=</span></code> instead of <code class="docutils literal notranslate"><span class="pre">:=</span></code>). Recursive expansion of your variables allows out-of-order
declaration and other neat tricks with <code class="docutils literal notranslate"><span class="pre">make</span></code>, since they are defined as rules,
which are expanded at runtime, rather than being defined while parsing.</p>
<p>For example, declaring and using your Fortran flags with this snippet will work
completely fine:</p>
<div class="highlight-make notranslate"><div class="highlight"><pre><span></span><span class="nf">all</span><span class="o">:</span>
	<span class="nb">echo</span> <span class="k">$(</span>FFLAGS<span class="k">)</span>

<span class="nv">FFLAGS</span> <span class="o">=</span> <span class="k">$(</span>include_dirs<span class="k">)</span> -O
<span class="nv">include_dirs</span> <span class="o">+=</span> -I./include
<span class="nv">include_dirs</span> <span class="o">+=</span> -I/opt/some_dep/include
</pre></div>
</div>
<p>You should find the expected (or maybe unexpected) printout after running <code class="docutils literal notranslate"><span class="pre">make</span></code></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>echo -I./include -I/opt/some_dep/include -O
-I./include -I/opt/some_dep/include -O
</pre></div>
</div>
<p>{% include note.html content=&quot;appending with <code class="docutils literal notranslate"><span class="pre">+=</span></code> to an undefined variable will produce a recursively expanded variable with this state being inherited for all further appending.&quot; %}</p>
<p>While, it seems like an interesting feature to use, it tends to lead to
surprising and unexpected outcomes. Usually, when defining variables like your
compiler, there is little reason to actually use the recursive expansion at all.</p>
<p>The same can easily be archived using the <code class="docutils literal notranslate"><span class="pre">:=</span></code> declaration:</p>
<div class="highlight-make notranslate"><div class="highlight"><pre><span></span><span class="nf">all</span><span class="o">:</span>
	<span class="nb">echo</span> <span class="k">$(</span>FFLAGS<span class="k">)</span>

<span class="nv">include_dirs</span> <span class="o">:=</span> -I./include
<span class="nv">include_dirs</span> <span class="o">+=</span> -I/opt/some_dep/include
<span class="nv">FFLAGS</span> <span class="o">:=</span> <span class="k">$(</span>include_dirs<span class="k">)</span> -O
</pre></div>
</div>
<p>{% include important.html content=&quot;always think of a <code class="docutils literal notranslate"><span class="pre">Makefile</span></code> as a whole set of rules, it must be parsed completely before any rule can be evaluated.&quot; %}</p>
<p>You can use whatever kind of variables you like most, mixing them should be done
carefully, of course. It is important to be aware of the differences between the
two kinds and the respective implications.</p>
</section>
<section id="comments-and-whitespace">
<h2>Comments and whitespace<a class="headerlink" href="#comments-and-whitespace" title="Permalink to this headline">Â¶</a></h2>
<p>There are some caveats with whitespace and comments, which might pop up from
time to time when using <code class="docutils literal notranslate"><span class="pre">make</span></code>. First, <code class="docutils literal notranslate"><span class="pre">make</span></code> does not know of any data
type except for strings and the default separator is just a space.
This means <code class="docutils literal notranslate"><span class="pre">make</span></code> will give a hard time trying to build a project which
has spaces in file names. If you encounter such case, renaming the file
is possibly the easiest solution at hand.</p>
<p>Another common problem is leading and trailing whitespace, once introduced,
<code class="docutils literal notranslate"><span class="pre">make</span></code> will happily carry it along and it does in fact make a difference
when comparing strings in <code class="docutils literal notranslate"><span class="pre">make</span></code>.</p>
<p>Those can be introduced by comments like</p>
<div class="highlight-make notranslate"><div class="highlight"><pre><span></span><span class="nv">prefix</span> <span class="o">:=</span> /usr  <span class="c1"># path to install location</span>
<span class="nf">install</span><span class="o">:</span>
	<span class="nb">echo</span> <span class="s2">&quot;</span><span class="k">$(</span>prefix<span class="k">)</span><span class="s2">/lib&quot;</span>
</pre></div>
</div>
<p>While the comment will be correctly removed by <code class="docutils literal notranslate"><span class="pre">make</span></code>, the trailing two spaces
are now part of the variable content. Run <code class="docutils literal notranslate"><span class="pre">make</span></code> and check that this is indeed
the case:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">echo</span> <span class="s2">&quot;/usr  /lib&quot;</span>
<span class="o">/</span><span class="n">usr</span>  <span class="o">/</span><span class="n">lib</span>
</pre></div>
</div>
<p>To solve this issue, you can either move the comment, or strip the whitespace with
the <code class="docutils literal notranslate"><span class="pre">strip</span></code> function instead. Alternatively, you could try to <code class="docutils literal notranslate"><span class="pre">join</span></code> the
strings.</p>
<div class="highlight-make notranslate"><div class="highlight"><pre><span></span><span class="nv">prefix</span> <span class="o">:=</span> /usr  <span class="c1"># path to install location</span>
<span class="nf">install</span><span class="o">:</span>
	<span class="nb">echo</span> <span class="s2">&quot;</span><span class="k">$(</span>strip <span class="k">$(</span>prefix<span class="k">))</span><span class="s2">/lib&quot;</span>
	<span class="nb">echo</span> <span class="s2">&quot;</span><span class="k">$(</span>join <span class="k">$(</span>join <span class="k">$(</span>prefix<span class="k">)</span>, /<span class="k">)</span>, lib<span class="k">)</span><span class="s2">&quot;</span>
</pre></div>
</div>
<p>All in all, none of this solutions will make your <code class="docutils literal notranslate"><span class="pre">Makefile</span></code> more readable,
therefore, it is prudent to pay extra attention to whitespace and comments when
writing and using <code class="docutils literal notranslate"><span class="pre">make</span></code>.</p>
</section>
</section>
<section id="the-meson-build-system">
<h1>The meson build system<a class="headerlink" href="#the-meson-build-system" title="Permalink to this headline">Â¶</a></h1>
<p>After you have learned the basics of <code class="docutils literal notranslate"><span class="pre">make</span></code>, which we call a low-level build
system, we will introduce <code class="docutils literal notranslate"><span class="pre">meson</span></code>, a high-level build system.
While you specify in a low-level build system how to build your program,
you can use a high-level build system to specify what to build.
A high-level build system will deal for you with how and generate
build files for a low-level build system.</p>
<p>There are plenty of high-level build systems available, but we will focus on
<code class="docutils literal notranslate"><span class="pre">meson</span></code> because it is constructed to be particularly user friendly.
The default low-level build-system of <code class="docutils literal notranslate"><span class="pre">meson</span></code> is called <code class="docutils literal notranslate"><span class="pre">ninja</span></code>.</p>
<p>Let's have a look at a complete <code class="docutils literal notranslate"><span class="pre">meson.build</span></code> file:</p>
<!-- meson is unknown by the highlighter, python looks okayish -->
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">project</span><span class="p">(</span><span class="s1">&#39;my_proj&#39;</span><span class="p">,</span> <span class="s1">&#39;fortran&#39;</span><span class="p">,</span> <span class="n">meson_version</span><span class="p">:</span> <span class="s1">&#39;&gt;=0.49&#39;</span><span class="p">)</span>
<span class="n">executable</span><span class="p">(</span><span class="s1">&#39;my_prog&#39;</span><span class="p">,</span> <span class="n">files</span><span class="p">(</span><span class="s1">&#39;tabulate.f90&#39;</span><span class="p">,</span> <span class="s1">&#39;functions.f90&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>And we are already done, the next step is to configure our low-level build system
with <code class="docutils literal notranslate"><span class="pre">meson</span> <span class="pre">setup</span> <span class="pre">build</span></code>, you should see output somewhat similar to this</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>The Meson build system
Version: 0.53.2
Source dir: /home/awvwgk/Examples
Build dir: /home/awvwgk/Examples/build
Build type: native build
Project name: my_proj
Project version: undefined
Fortran compiler for the host machine: gfortran (gcc 9.2.1 &quot;GNU Fortran (Arch Linux 9.2.1+20200130-2) 9.2.1 20200130&quot;)
Fortran linker for the host machine: gfortran ld.bfd 2.34
Host machine cpu family: x86_64
Host machine cpu: x86_64
Build targets in project: 1

Found ninja-1.10.0 at /usr/bin/ninja
</pre></div>
</div>
<p>The provided information at this point is already more detailed than anything
we could have provided in a <code class="docutils literal notranslate"><span class="pre">Makefile</span></code>, let's run the build with
<code class="docutils literal notranslate"><span class="pre">ninja</span> <span class="pre">-C</span> <span class="pre">build</span></code>, which should show something like</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[1/4] Compiling Fortran object &#39;my_prog@exe/functions.f90.o&#39;.
[2/4] Dep hack
[3/4] Compiling Fortran object &#39;my_prog@exe/tabulate.f90.o&#39;.
[4/4] Linking target my_prog.
</pre></div>
</div>
<p>Find and test your program at <code class="docutils literal notranslate"><span class="pre">build/my_prog</span></code> to ensure it works correctly.
We note the steps <code class="docutils literal notranslate"><span class="pre">ninja</span></code> performed are the same we would have coded up in a
<code class="docutils literal notranslate"><span class="pre">Makefile</span></code> (including the dependency), yet we did not have to specify them,
have a look at your <code class="docutils literal notranslate"><span class="pre">meson.build</span></code> file again:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">project</span><span class="p">(</span><span class="s1">&#39;my_proj&#39;</span><span class="p">,</span> <span class="s1">&#39;fortran&#39;</span><span class="p">,</span> <span class="n">meson_version</span><span class="p">:</span> <span class="s1">&#39;&gt;=0.49&#39;</span><span class="p">)</span>
<span class="n">executable</span><span class="p">(</span><span class="s1">&#39;my_prog&#39;</span><span class="p">,</span> <span class="n">files</span><span class="p">(</span><span class="s1">&#39;tabulate.f90&#39;</span><span class="p">,</span> <span class="s1">&#39;functions.f90&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>We only specified that we have a Fortran project (which happens to require
a certain version of <code class="docutils literal notranslate"><span class="pre">meson</span></code> for the Fortran support) and told <code class="docutils literal notranslate"><span class="pre">meson</span></code>
to build an executable <code class="docutils literal notranslate"><span class="pre">my_prog</span></code> from the files <code class="docutils literal notranslate"><span class="pre">tabulate.f90</span></code> and
<code class="docutils literal notranslate"><span class="pre">functions.f90</span></code>.
We had not to tell <code class="docutils literal notranslate"><span class="pre">meson</span></code> how to build the project, it figured this out
by itself.</p>
<p>{% capture note %}</p>
<p><code class="docutils literal notranslate"><span class="pre">meson</span></code> is a cross-platform build system, the project you just specified
for your program can be used to compile binaries for your native operating
system or to cross-compile your project for other platforms.
Similarly, the <code class="docutils literal notranslate"><span class="pre">meson.build</span></code> file is portable and will work on different
platforms as well.
{% endcapture %}
{% include note.html title=&quot;Note&quot; content=note %}</p>
<p>The documentation of <code class="docutils literal notranslate"><span class="pre">meson</span></code> can be found at the
<a href="https://mesonbuild.com/" target="_blank" rel="noopener">meson-build webpage</a>.</p>
</section>
<section id="creating-a-cmake-project">
<h1>Creating a CMake project<a class="headerlink" href="#creating-a-cmake-project" title="Permalink to this headline">Â¶</a></h1>
<p>Similar to <code class="docutils literal notranslate"><span class="pre">meson</span></code> CMake is a high-level build system as well and commonly
used to build Fortran projects.</p>
<p>{% capture note %}</p>
<p>CMake follows a slightly different strategy and provides you with a complete
programming language to create your build files.
This is has the advantage that you can do almost everything with CMake,
but your CMake build files can also become as complex as the program you are
building.
{% endcapture %}
{% include note.html title=&quot;Note&quot; content=note %}</p>
<p>Start by creating the file <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> with the content</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">cmake_minimum_required</span><span class="p">(</span><span class="s">VERSION</span><span class="w"> </span><span class="s">3.7</span><span class="p">)</span>
<span class="nb">project</span><span class="p">(</span><span class="s2">&quot;my_proj&quot;</span><span class="w"> </span><span class="s">LANGUAGES</span><span class="w"> </span><span class="s2">&quot;Fortran&quot;</span><span class="p">)</span>
<span class="nb">add_executable</span><span class="p">(</span><span class="s2">&quot;my_prog&quot;</span><span class="w"> </span><span class="s2">&quot;tabulate.f90&quot;</span><span class="w"> </span><span class="s2">&quot;functions.f90&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Similar to <code class="docutils literal notranslate"><span class="pre">meson</span></code> we are already done with our CMake build file.
We configure our low-level build files with <code class="docutils literal notranslate"><span class="pre">cmake</span> <span class="pre">-B</span> <span class="pre">build</span> <span class="pre">-G</span> <span class="pre">Ninja</span></code>,
you should see output similar to this</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>-- The Fortran compiler identification is GNU 10.2.0
-- Detecting Fortran compiler ABI info
-- Detecting Fortran compiler ABI info - done
-- Check for working Fortran compiler: /usr/bin/f95 - skipped
-- Checking whether /usr/bin/f95 supports Fortran 90
-- Checking whether /usr/bin/f95 supports Fortran 90 - yes
-- Configuring done
-- Generating done
-- Build files have been written to: /home/awvwgk/Examples/build
</pre></div>
</div>
<p>You might be surprised that CMake tries to use the compiler <code class="docutils literal notranslate"><span class="pre">f95</span></code>, fortunately
this is just a symbolic link to <code class="docutils literal notranslate"><span class="pre">gfortran</span></code> on most systems and not the actual
<code class="docutils literal notranslate"><span class="pre">f95</span></code> compiler.
To give CMake a better hint you can export the environment variable <code class="docutils literal notranslate"><span class="pre">FC=gfortran</span></code>
rerunning should show the correct compiler name now</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>-- The Fortran compiler identification is GNU 10.2.0
-- Detecting Fortran compiler ABI info
-- Detecting Fortran compiler ABI info - done
-- Check for working Fortran compiler: /usr/bin/gfortran - skipped
-- Checking whether /usr/bin/gfortran supports Fortran 90
-- Checking whether /usr/bin/gfortran supports Fortran 90 - yes
-- Configuring done
-- Generating done
-- Build files have been written to: /home/awvwgk/Example/build
</pre></div>
</div>
<p>In a similar manner you could use your Intel Fortran compiler instead to build
your project (set <code class="docutils literal notranslate"><span class="pre">FC=ifort</span></code>).</p>
<p>CMake provides support for several low-level build files, since the default is
platform specific, we will just use <code class="docutils literal notranslate"><span class="pre">ninja</span></code> since we already used it together
with <code class="docutils literal notranslate"><span class="pre">meson</span></code>. As before, build your project with <code class="docutils literal notranslate"><span class="pre">ninja</span> <span class="pre">-C</span> <span class="pre">build</span></code>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[1/6] Building Fortran preprocessed CMakeFiles/my_prog.dir/functions.f90-pp.f90
[2/6] Building Fortran preprocessed CMakeFiles/my_prog.dir/tabulate.f90-pp.f90
[3/6] Generating Fortran dyndep file CMakeFiles/my_prog.dir/Fortran.dd
[4/6] Building Fortran object CMakeFiles/my_prog.dir/functions.f90.o
[5/6] Building Fortran object CMakeFiles/my_prog.dir/tabulate.f90.o
[6/6] Linking Fortran executable my_prog
</pre></div>
</div>
<p>Find and test your program at <code class="docutils literal notranslate"><span class="pre">build/my_prog</span></code> to ensure it works correctly.
The steps <code class="docutils literal notranslate"><span class="pre">ninja</span></code> performed are somewhat different, because there is usually
more than one way to write the low-level build files to accomplish the task
of building a project. Fortunately, we do not have to concern ourselves but have
our build system handle those details for us.</p>
<p>Finally, we will shortly recap on our complete <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> to specify
our project:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">cmake_minimum_required</span><span class="p">(</span><span class="s">VERSION</span><span class="w"> </span><span class="s">3.7</span><span class="p">)</span>
<span class="nb">project</span><span class="p">(</span><span class="s2">&quot;my_proj&quot;</span><span class="w"> </span><span class="s">LANGUAGES</span><span class="w"> </span><span class="s2">&quot;Fortran&quot;</span><span class="p">)</span>
<span class="nb">add_executable</span><span class="p">(</span><span class="s2">&quot;my_prog&quot;</span><span class="w"> </span><span class="s2">&quot;tabulate.f90&quot;</span><span class="w"> </span><span class="s2">&quot;functions.f90&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>We specified that we have a Fortran project and told CMake to create an executable
<code class="docutils literal notranslate"><span class="pre">my_prog</span></code> from  the files <code class="docutils literal notranslate"><span class="pre">tabulate.f90</span></code> and <code class="docutils literal notranslate"><span class="pre">functions.f90</span></code>.
CMake knows the details how to build the executable from the specified sources,
so we do not have to worry about the actual steps in the build process.</p>
<p>{% capture note %}</p>
<p>CMake's offical reference can be found at the
&lt;a href=&quot;https://cmake.org/cmake/help/latest/&quot;, target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;CMake webpage</a>.
It is organised in manpages, which are also available with your local CMake
installation as well using <code class="docutils literal notranslate"><span class="pre">man</span> <span class="pre">cmake</span></code>. While it covers all functionality of
CMake, it sometimes covers them only very briefly.
{% endcapture %}
{% include note.html title=&quot;Note&quot; content=note %}</p>
</section>

<div class="section">
   
</div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">Fortran-lang.org website</a></h1>








<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../learn/index.html">Learn</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2022, Fortran Community.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 4.5.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../../_sources/learn_website/building_programs/build_tools.md.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>